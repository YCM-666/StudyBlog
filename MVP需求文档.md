# 多用户博客平台 MVP 需求文档
## 一、文档概述
### 1. 项目背景
本项目是基于 React 前端、Supabase 后端（数据库+身份认证+权限控制）、Netlify 部署的多用户博客平台，核心目标是实现「用户自主博客创作」与「社区互动交流」的功能闭环，为所有注册用户提供博客发布、管理和互动功能，构建开放的博客创作社区。

### 2. 目标用户
- 注册用户：可发布、编辑、删除自己的博客，发表评论，管理个人内容。
- 访客：浏览博客列表、查看博客详情、查看评论内容。

### 3. MVP 范围
聚焦核心功能闭环，暂不包含复杂功能（如分类标签多级嵌套、高级搜索、用户个人中心、消息通知等），确保基础功能稳定可用。

## 二、功能模块
### 1. 身份认证与权限管理（核心）
| 功能点 | 描述 | 权限范围 |
|--------|------|----------|
| 注册功能 | 所有用户通过邮箱/密码注册，成为平台用户，获得博客发布权限 | 所有访客：开放注册 |
| 登录功能 | 支持邮箱/密码登录，登录状态持久化（localStorage + Supabase Auth 会话） | 所有注册用户 |
| 权限区分 | 基于 Supabase RLS（行级安全策略）控制数据访问：<br>- 注册用户：可发布/编辑/删除自己的博客，发表/编辑/删除自己的评论<br>- 访客：仅可查看博客和评论 | 系统自动校验 |
| 退出登录 | 清除登录状态，跳转至首页 | 所有用户 |

### 2. 博客核心功能
| 功能模块 | 功能点 | 描述 | 权限范围 |
|----------|--------|------|----------|
| 博客列表 | 分页展示 | 按发布时间倒序排列，每页显示 10 篇博客，支持页码切换 | 所有用户 |
|          | 博客预览 | 展示博客标题、发布时间、摘要、作者姓名、阅读量 | 所有用户 |
| 博客详情 | 内容展示 | 完整展示博客标题、发布时间、作者信息、正文（支持 Markdown 渲染）、阅读量、点赞数（可选） | 所有用户 |
|          | 阅读量统计 | 打开详情页自动累加阅读量（同一用户 24 小时内多次访问仅统计 1 次） | 系统自动触发 |
| 博客管理（注册用户） | 发布博客 | 支持输入标题、摘要、Markdown 正文，发布后状态为「已发布」 | 所有注册用户 |
|          | 编辑博客 | 可修改自己的已发布/草稿博客的标题、摘要、正文 | 所有注册用户（仅限自己的博客） |
|          | 删除博客 | 永久删除自己的博客（MVP 暂不支持回收站） | 所有注册用户（仅限自己的博客） |
|          | 草稿功能 | 支持保存未完成的博客为草稿，草稿仅作者本人可见 | 所有注册用户 |

### 3. 评论功能
| 功能点 | 描述 | 权限范围 |
|--------|------|----------|
| 发表评论 | 登录后可对博客发表评论，输入内容限制 1-500 字 | 所有注册用户 |
| 查看评论 | 博客详情页按发布时间正序展示所有评论（包含评论者、发布时间、内容） | 所有用户 |
| 编辑评论 | 仅可编辑自己发布的评论 | 所有注册用户（仅限自己的评论） |
| 删除评论 | 仅可删除自己发布的评论 | 所有注册用户（仅限自己的评论） |

### 4. 用户个人中心
| 功能点 | 描述 | 权限范围 |
|--------|------|----------|
| 个人数据概览 | 展示个人博客总数、评论总数、总阅读量（基础统计） | 所有注册用户 |
| 博客管理 | 展示个人所有博客（含草稿），支持按「发布状态」筛选，提供「编辑/删除」操作入口 | 所有注册用户 |
| 评论管理 | 展示个人所有评论，支持按「博客标题」筛选，提供「编辑/删除」操作入口 | 所有注册用户 |

## 三、用户流程
### 1. 访客流程
```
访问首页 → 浏览博客列表 → 点击博客进入详情页 → 查看评论 → （选择注册登录后发表评论）
```
- 未登录用户：可浏览博客列表、查看博客详情、查看评论；无法发表评论或博客；点击「发表评论」或「发布博客」会引导跳转至登录页。

### 2. 注册用户流程
```
访问首页 → 登录/注册 → 进入个人中心：
  → 个人数据概览 → 查看个人统计
  → 我的博客 → 发布/编辑/删除自己的博客/保存草稿
  → 我的评论 → 管理自己的评论
→ 前台浏览其他用户博客/发表评论
```

### 3. 关键流程说明
- 注册/登录流程：输入邮箱/密码 → Supabase Auth 验证 → 验证通过跳转至原页面（或个人中心），获得完整用户权限。
- 发布博客流程：用户进入「发布博客」页面 → 输入标题/摘要/Markdown 正文 → 选择「保存草稿」或「发布」→ 数据存储至 Supabase 博客表，发布时自动记录发布时间和作者。
- 评论流程：用户登录后在博客详情页输入评论内容 → 提交后存储至 Supabase 评论表，关联对应博客 ID 和用户 ID → 页面实时刷新显示评论。

## 四、技术要求
### 1. 前端技术栈
- 核心框架：React 18+（使用 Functional Components + Hooks）
- 路由管理：React Router v6（实现页面跳转和权限守卫）
- UI 组件库：Chakra UI / Tailwind CSS（简洁、响应式设计，适配移动端和桌面端）
- 数据请求：Supabase JS Client（直接调用 Supabase API 操作数据，无需自定义后端）
- Markdown 渲染：React Markdown（渲染博客正文和评论中的 Markdown 内容）
- 状态管理：React Context + useReducer（管理用户登录状态、全局权限等）
- 表单处理：React Hook Form（简化发布/编辑博客、评论的表单逻辑）

### 2. 后端（Supabase）配置
#### （1）数据表设计（至少 3 张）
| 表名 | 字段名 | 字段类型 | 说明 | 关联关系 |
|------|--------|----------|------|----------|
| `profiles`（用户信息表） | `id` | `uuid` | 主键，关联 Supabase Auth 的 `auth.users.id` | 一对一关联 `auth.users` |
|      | `username` | `text` | 用户名（显示用） | 非空 |
|      | `avatar_url` | `text` | 头像URL（可选） | 可选 |
|      | `bio` | `text` | 个人简介（可选） | 可选 |
|      | `created_at` | `timestamp` | 创建时间 | 自动生成 |
| `posts`（博客表） | `id` | `uuid` | 主键 | - |
|      | `title` | `text` | 博客标题 | 非空 |
|      | `summary` | `text` | 博客摘要 | 可选 |
|      | `content` | `text` | 博客正文（Markdown 格式） | 非空 |
|      | `status` | `text` | 状态（`published`/`draft`） | 非空，默认 `draft` |
|      | `view_count` | `integer` | 阅读量 | 默认 0 |
|      | `like_count` | `integer` | 点赞数（可选） | 默认 0 |
|      | `author_id` | `uuid` | 作者 ID | 外键关联 `profiles.id`，非空 |
|      | `created_at` | `timestamp` | 创建时间 | 自动生成 |
|      | `updated_at` | `timestamp` | 更新时间 | 自动更新 |
| `comments`（评论表） | `id` | `uuid` | 主键 | - |
|      | `post_id` | `uuid` | 关联博客 ID | 外键关联 `posts.id`，非空 |
|      | `user_id` | `uuid` | 评论者 ID | 外键关联 `profiles.id`，非空 |
|      | `content` | `text` | 评论内容 | 非空（1-500 字） |
|      | `created_at` | `timestamp` | 创建时间 | 自动生成 |
|      | `updated_at` | `timestamp` | 更新时间 | 自动更新 |

#### （2）RLS 行级安全策略（核心权限控制）
- `profiles` 表：
  - 所有用户可查看所有 `profiles` 记录（仅暴露 `id`/`username`/`avatar_url`/`bio`，隐藏敏感字段）。
  - 仅用户本人可更新自己的 `profiles` 记录（MVP 暂不支持用户修改个人信息，可预留策略）。
- `posts` 表：
  - 所有用户可查看 `status = 'published'` 的博客。
  - 仅作者本人可查看 `status = 'draft'` 的博客（`author_id = auth.uid()`）。
  - 所有注册用户可插入博客，仅作者本人可更新/删除自己的博客（`author_id = auth.uid()`）。
- `comments` 表：
  - 所有用户可查看所有评论。
  - 所有注册用户可插入评论，仅评论者本人可更新/删除自己的评论（`user_id = auth.uid()`）。

#### （3）Supabase 其他配置
- Auth 配置：启用邮箱/密码登录，关闭第三方登录（MVP 简化）。
- 触发器（可选）：`posts` 表的 `updated_at` 字段自动更新、`view_count` 字段防重复统计。

### 3. 部署与版本控制
- 版本控制：GitHub 仓库管理代码，分支策略为「main（生产分支）+ dev（开发分支）」，通过 Pull Request 合并代码。
- 自动化部署：Netlify 关联 GitHub 仓库，配置「main 分支更新时自动部署」，生成公开访问域名。
- 环境变量：前端通过 Netlify 配置环境变量（`REACT_APP_SUPABASE_URL`、`REACT_APP_SUPABASE_ANON_KEY`），避免硬编码敏感信息。

### 4. 性能与兼容性要求
- 响应式设计：适配桌面端（≥1200px）、平板（768px-1199px）、移动端（≤767px）。
- 页面加载速度：首屏加载时间 ≤3s（依赖 Netlify CDN 和 Supabase 接口响应速度）。
- 浏览器兼容性：支持 Chrome、Firefox、Safari 最新 3 个版本，Edge 最新版本。

## 五、界面设计建议
### 1. 整体设计风格
- 基调：简洁、清爽、专注内容，以文字阅读为核心，避免过多装饰元素。
- 配色：主色调（如 #2D3748 深灰）+ 辅助色（如 #3182CE 蓝色）+ 中性色（白、浅灰、深灰），确保文字与背景对比度符合 WCAG 标准（便于阅读）。
- 字体：正文使用无衬线字体（如 Inter、Roboto），标题加粗，正文行高 1.6-1.8（提升阅读舒适度）。

### 2. 核心页面设计
#### （1）首页（博客列表页）
- 顶部导航栏：Logo（博客名称）、「首页」链接、「登录/退出」按钮（根据登录状态切换）、博主专属「后台管理」入口（仅博主登录后显示）。
- 主体区域：
  - 博客卡片列表（分页）：每张卡片包含「标题（加粗，hover 下划线）、摘要（灰色小字，最多 2 行省略）、发布时间 + 阅读量（右下角小字）」。
  - 分页控件：底部显示页码，支持「上一页/下一页」跳转。
- 页脚：版权信息（© 2025 个人博客）、Supabase + Netlify 技术栈标注（可选）。

#### （2）博客详情页
- 顶部导航栏：同首页。
- 博客内容区：
  - 标题（大字体、居中）、发布时间（灰色小字、居中）。
  - 正文（Markdown 渲染，段落间距适中，代码块高亮）。
  - 互动区域：点赞按钮（显示点赞数）、「回到顶部」按钮。
- 评论区：
  - 评论输入框（仅登录用户可见，支持简单 Markdown 语法）+ 提交按钮。
  - 评论列表：每条评论包含「用户名（加粗）、发布时间（灰色小字）、内容、编辑/删除按钮（仅本人或博主可见）」。
- 页脚：同首页。

#### （3）用户个人中心 - 数据概览页
- 顶部导航：「首页」「我的博客」「发布博客」「我的评论」「退出登录」。
- 主体区域：
  - 个人统计卡片：博客总数（区分已发布/草稿）、评论总数、总阅读量（数字突出显示）。
  - 简单图表（可选）：近 7 天个人博客阅读量趋势（使用 Recharts 实现）。

#### （4）用户个人中心 - 博客管理页
- 顶部导航：同数据概览页。
- 主体区域：
  - 操作栏：「发布新博客」按钮、「状态筛选」下拉框（全部/已发布/草稿）。
  - 博客列表表格：列包含「标题、状态、发布时间、阅读量、操作（编辑/删除）」。
- 发布/编辑博客页：
  - 表单：标题输入框、摘要输入框（textarea）、Markdown 编辑器（支持预览切换）、「保存草稿」/「发布」按钮。

#### （5）登录/注册页
- 居中布局：白色卡片（带阴影），包含「登录/注册」标签切换。
- 表单：邮箱输入框、密码输入框、用户名输入框（注册时）、「提交」按钮。
- 辅助提示：忘记密码（MVP 暂不实现，预留入口）、「还没有账号？去注册」/「已有账号？去登录」切换链接。

#### （6）用户个人中心页
- 顶部导航栏：同首页，增加「我的博客」「发布博客」快捷入口。
- 主体区域：
  - 个人统计卡片：博客总数（区分已发布/草稿）、评论总数、总阅读量（数字突出显示）。
  - 我的博客管理：列表形式展示个人所有博客（含草稿），提供「编辑/删除」操作入口。
  - 我的评论管理：展示个人所有评论，提供「编辑/删除」操作入口。

### 3. 交互设计建议
- 登录/注册：表单实时校验（如邮箱格式、密码长度≥6 位），提交失败显示错误提示（红色文字）。
- 发布/编辑博客：自动保存草稿（localStorage 临时存储，防止页面刷新丢失内容）。
- 评论操作：编辑/删除评论时弹出确认框，避免误操作。
- 分页：切换页码时无刷新加载（使用 React Router 实现分页参数拼接，如 `/page/2`）。
- 加载状态：数据请求时显示加载动画（如骨架屏、Spinner），避免用户等待焦虑。

## 六、MVP 验收标准
1. 功能验收：
   - 访客：可浏览博客列表/详情、查看评论内容。
   - 注册用户：可注册/登录、浏览所有博客、发布/编辑/删除自己的博客、发表/管理自己的评论。
   - 权限控制：用户只能操作自己的博客和评论；未登录用户无法发表评论或博客。
2. 技术验收：
   - Supabase 数据表设计符合要求，RLS 策略生效，数据访问权限正确。
   - 前端页面响应式适配，无布局错乱。
   - Netlify 自动化部署成功，代码提交至 GitHub 后自动更新线上版本。
3. 体验验收：
   - 页面加载流畅，无明显卡顿。
   - 交互反馈清晰（如按钮点击、表单提交、错误提示）。

## 七、后续迭代方向（MVP 外扩展）
1. 功能扩展：分类/标签管理、高级搜索（按标题/内容/标签）、用户个人中心（修改资料、收藏博客）。
2. 体验优化：博客内容目录导航、评论回复功能、Markdown 编辑器增强（上传图片至 Supabase Storage）。
3. 数据统计：更详细的用户访问分析、博客热度排行。
4. 性能优化：博客内容缓存、图片懒加载、接口请求节流/防抖。