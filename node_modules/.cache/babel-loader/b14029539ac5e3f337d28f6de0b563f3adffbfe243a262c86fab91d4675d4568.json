{"ast":null,"code":"import _objectSpread from\"C:/Users/12798/Desktop/\\u4F5C\\u4E1A2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useReducer,useEffect}from'react';import{supabase}from'../supabase';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();const authReducer=(state,action)=>{switch(action.type){case'LOGIN_START':return _objectSpread(_objectSpread({},state),{},{loading:true,error:null});case'LOGIN_SUCCESS':return _objectSpread(_objectSpread({},state),{},{user:action.payload.user,profile:action.payload.profile,loading:false,error:null});case'LOGIN_FAILURE':return _objectSpread(_objectSpread({},state),{},{loading:false,error:action.payload});case'LOGOUT':return _objectSpread(_objectSpread({},state),{},{user:null,profile:null,loading:false,error:null});case'SET_LOADING':return _objectSpread(_objectSpread({},state),{},{loading:action.payload});case'CLEAR_ERROR':return _objectSpread(_objectSpread({},state),{},{error:null});default:return state;}};const initialState={user:null,profile:null,loading:true,error:null};export const AuthProvider=_ref=>{let{children}=_ref;const[state,dispatch]=useReducer(authReducer,initialState);useEffect(()=>{const getSession=async()=>{const{data:{session}}=await supabase.auth.getSession();if(session!==null&&session!==void 0&&session.user){var _session$user$user_me;// 所有注册用户都有发布博客权限\nconst mockProfile={id:session.user.id,username:((_session$user$user_me=session.user.user_metadata)===null||_session$user$user_me===void 0?void 0:_session$user$user_me.username)||'用户',role:'user'};dispatch({type:'LOGIN_SUCCESS',payload:{user:session.user,profile:mockProfile}});}else{dispatch({type:'SET_LOADING',payload:false});}};getSession();const{data:{subscription}}=supabase.auth.onAuthStateChange(async(event,session)=>{if(session!==null&&session!==void 0&&session.user){var _session$user$user_me2;// 所有注册用户都有发布博客权限\nconst mockProfile={id:session.user.id,username:((_session$user$user_me2=session.user.user_metadata)===null||_session$user$user_me2===void 0?void 0:_session$user$user_me2.username)||'用户',role:'user'};dispatch({type:'LOGIN_SUCCESS',payload:{user:session.user,profile:mockProfile}});}else{dispatch({type:'LOGOUT'});}});return()=>subscription.unsubscribe();},[]);const login=async(email,password)=>{try{dispatch({type:'LOGIN_START'});const{data,error}=await supabase.auth.signInWithPassword({email,password});if(error)throw error;const{data:profile}=await supabase.from('profiles').select('*').eq('id',data.user.id).single();dispatch({type:'LOGIN_SUCCESS',payload:{user:data.user,profile}});return{success:true};}catch(error){dispatch({type:'LOGIN_FAILURE',payload:error.message});return{success:false,error:error.message};}};const register=async(email,password,username)=>{try{dispatch({type:'LOGIN_START'});const{data,error}=await supabase.auth.signUp({email,password});if(error)throw error;// 注册成功 - 新用户都是注册用户，有发布博客权限\nconst mockProfile={id:data.user.id,username,role:'user'};dispatch({type:'LOGIN_SUCCESS',payload:{user:data.user,profile:mockProfile}});return{success:true,message:'注册成功！'};}catch(error){dispatch({type:'LOGIN_FAILURE',payload:error.message});return{success:false,error:error.message};}};const logout=async()=>{await supabase.auth.signOut();dispatch({type:'LOGOUT'});};const clearError=()=>{dispatch({type:'CLEAR_ERROR'});};const value=_objectSpread(_objectSpread({},state),{},{login,register,logout,clearError});return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};","map":{"version":3,"names":["React","createContext","useContext","useReducer","useEffect","supabase","jsx","_jsx","AuthContext","authReducer","state","action","type","_objectSpread","loading","error","user","payload","profile","initialState","AuthProvider","_ref","children","dispatch","getSession","data","session","auth","_session$user$user_me","mockProfile","id","username","user_metadata","role","subscription","onAuthStateChange","event","_session$user$user_me2","unsubscribe","login","email","password","signInWithPassword","from","select","eq","single","success","message","register","signUp","logout","signOut","clearError","value","Provider","useAuth","context","Error"],"sources":["C:/Users/12798/Desktop/作业2/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useReducer, useEffect } from 'react';\r\nimport { supabase } from '../supabase';\r\n\r\nconst AuthContext = createContext();\r\n\r\nconst authReducer = (state, action) => {\r\n  switch (action.type) {\r\n    case 'LOGIN_START':\r\n      return { ...state, loading: true, error: null };\r\n    case 'LOGIN_SUCCESS':\r\n      return { \r\n        ...state, \r\n        user: action.payload.user, \r\n        profile: action.payload.profile, \r\n        loading: false, \r\n        error: null \r\n      };\r\n    case 'LOGIN_FAILURE':\r\n      return { ...state, loading: false, error: action.payload };\r\n    case 'LOGOUT':\r\n      return { ...state, user: null, profile: null, loading: false, error: null };\r\n    case 'SET_LOADING':\r\n      return { ...state, loading: action.payload };\r\n    case 'CLEAR_ERROR':\r\n      return { ...state, error: null };\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nconst initialState = {\r\n  user: null,\r\n  profile: null,\r\n  loading: true,\r\n  error: null,\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [state, dispatch] = useReducer(authReducer, initialState);\r\n\r\n  useEffect(() => {\r\n    const getSession = async () => {\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      \r\n      if (session?.user) {\r\n        // 所有注册用户都有发布博客权限\r\n        const mockProfile = { \r\n          id: session.user.id, \r\n          username: session.user.user_metadata?.username || '用户', \r\n          role: 'user'\r\n        };\r\n\r\n        dispatch({\r\n          type: 'LOGIN_SUCCESS',\r\n          payload: { user: session.user, profile: mockProfile }\r\n        });\r\n      } else {\r\n        dispatch({ type: 'SET_LOADING', payload: false });\r\n      }\r\n    };\r\n\r\n    getSession();\r\n\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\r\n      async (event, session) => {\r\n        if (session?.user) {\r\n          // 所有注册用户都有发布博客权限\r\n          const mockProfile = { \r\n            id: session.user.id, \r\n            username: session.user.user_metadata?.username || '用户', \r\n            role: 'user'\r\n          };\r\n\r\n          dispatch({\r\n            type: 'LOGIN_SUCCESS',\r\n            payload: { user: session.user, profile: mockProfile }\r\n          });\r\n        } else {\r\n          dispatch({ type: 'LOGOUT' });\r\n        }\r\n      }\r\n    );\r\n\r\n    return () => subscription.unsubscribe();\r\n  }, []);\r\n\r\n  const login = async (email, password) => {\r\n    try {\r\n      dispatch({ type: 'LOGIN_START' });\r\n      \r\n      const { data, error } = await supabase.auth.signInWithPassword({\r\n        email,\r\n        password,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('*')\r\n        .eq('id', data.user.id)\r\n        .single();\r\n\r\n      dispatch({\r\n        type: 'LOGIN_SUCCESS',\r\n        payload: { user: data.user, profile }\r\n      });\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      dispatch({\r\n        type: 'LOGIN_FAILURE',\r\n        payload: error.message\r\n      });\r\n      return { success: false, error: error.message };\r\n    }\r\n  };\r\n\r\n  const register = async (email, password, username) => {\r\n    try {\r\n      dispatch({ type: 'LOGIN_START' });\r\n      \r\n      const { data, error } = await supabase.auth.signUp({\r\n        email,\r\n        password,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      // 注册成功 - 新用户都是注册用户，有发布博客权限\r\n      const mockProfile = { id: data.user.id, username, role: 'user' };\r\n      \r\n      dispatch({\r\n        type: 'LOGIN_SUCCESS',\r\n        payload: { user: data.user, profile: mockProfile }\r\n      });\r\n\r\n      return { success: true, message: '注册成功！' };\r\n    } catch (error) {\r\n      dispatch({\r\n        type: 'LOGIN_FAILURE',\r\n        payload: error.message\r\n      });\r\n      return { success: false, error: error.message };\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    await supabase.auth.signOut();\r\n    dispatch({ type: 'LOGOUT' });\r\n  };\r\n\r\n  const clearError = () => {\r\n    dispatch({ type: 'CLEAR_ERROR' });\r\n  };\r\n\r\n  const value = {\r\n    ...state,\r\n    login,\r\n    register,\r\n    logout,\r\n    clearError,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}